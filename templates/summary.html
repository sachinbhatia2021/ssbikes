<!DOCTYPE html>
<html lang="en">

<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta http-equiv="refresh" content="150">
  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate">
  <meta http-equiv="Pragma" content="no-cache">
  <meta http-equiv="Expires" content="0">
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
    integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">
    <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>

  <link rel="icon" type="image/x-icon" href="/static/logo.jpeg">
  <title>Inverter Analytics</title>
  <style>
    

    .sidenav {
      height: 100%;
      width: 0;
      position: fixed;
      z-index: 1;
      top: 0;
      left: 0;
      background-color: #f5f7fa;
      overflow-x: hidden;
      transition: 0.5s;
      padding-top: 60px;
    }

    .sidenav a {
      padding: 8px 8px 8px 32px;
      text-decoration: none;
      font-size: 20px;
      color: #818181;
      display: block;
      transition: 0.3s;
    }

    .sidenav a:hover {
      color: #0e0707;
    }

    .sidenav .closebtn {
      position: absolute;
      top: 0;
      right: 25px;
      font-size: 36px;
      margin-left: 50px;
    }

    #main {
      transition: margin-left .5s;
      padding: 16px;
    }

    @media screen and (max-height: 450px) {
      .sidenav {
        padding-top: 15px;
      }

      .sidenav a {
        font-size: 18px;
      }
    }

    .nav {
      height: 60px;
      width: 100%;
      float: left;
      background-color: #f5f7fa;
      position: fixed;
      top: 0;
      z-index: 10;
      display: flex;
      flex-direction: row;
      display: flex;
      justify-content: space-between;
      align-items: center;
      box-shadow: 0px 0px 5px 5px rgba(0, 0, 0, 0.1);

    }

    li {
      display: inline-flex;
      float: right-reverse;
    }

    .logo {
      height: auto;
      width: 50px;
      padding-left: 10px;
      padding-right: 10px;
    }

    .nav a {
      display: flex;
      align-items: center;
      color: blue;
      text-decoration: none;
    }

    .nav ul {
      list-style-type: none;
      padding: 0;
      margin: 0;
    }

    .nav ul li {
      display: inline-block;
      margin-left: 10px;
      padding-right: 15px;
    }

    li a.ex2:hover,
    a.ex2:active {
      height: 60px;
      width: 100%;
    }

    li a:hover:not(.active) {
      background-color: #5bcefc;
      color: white;
      padding: 5px;
      border-radius: 5px;
    }

    .nav .name a {
      margin-left: 45px;
      font-size: 20px;
      top: 15px;
      color: #043585;
      float: left;
      position: absolute;
      left: 0;
    }


    .con_small {
      padding: 10px;
      display: flex;
      flex-direction: row;
      margin-top: 30px;
      justify-content: space-between;

    }

    .half-width {
      width: calc(50% - 10px);
      height: 150px;
      margin: 20px;
      border: none;
      box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.7s ease;
      overflow: hidden;

    }

    .half-width:hover {
      transform: scale(1.03);
      background-color: #f2f4f8;
    }


    @media (max-width: 768px) {
      .con_small {
        flex-wrap: wrap;
      }

      .half-width {
        width: calc(50% - 20px);
        margin: 10px;
      }
    }

    .line2 {
      background-color: #f2f4f8;
      height: 80px;
      margin: 28px;
      padding: 20px;
      border: none;
      box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.7s ease;
      overflow: hidden;

    }

    .Inverter1 {
      height: auto;
      background-color: #f2f4f8;
      margin: 24px;
      padding: 10px;
      border: none;
      box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.7s ease;
      overflow: hidden;
    }

    .graphdiv1 {
      display: flex;
    }

    .chart1 {
      height: auto;
      background-color: #f2f4f8;
      margin: 28px;
      padding: 20px;
      border: none;
      box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.7s ease;
      overflow: hidden;
    }

    .chart2 {
      height: auto;
      background-color: #f2f4f8;
      margin: 28px;
      padding: 20px;
      width: 50%;
      border: none;
      box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
      transition: transform 0.7s ease;
      overflow: hidden;
    }

    @media(max-width:576px) {
      .Inverter1 {
        height: auto;
        background-color: #f2f4f8;
        width: 100%;
        border: none;
        box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.7s ease;
        overflow: hidden;
      }

      .graphdiv1 {
        display: block
      }


      .chart2 {
        height: auto;
        background-color: #f2f4f8;
        width: 95%;
        border: none;
        box-shadow: 10px 10px 10px 10px rgba(0, 0, 0, 0.1);
        transition: transform 0.7s ease;
        overflow: hidden;
      }
    }

       /* battery  */

       small { font-size: .7em }
svg { display: block }
.page-spacer {
    min-height: 171px;
    height: calc(100% - 160px);
}
.battery-text {
    width: 16%;
    -webkit-background-clip: text;
    -webkit-text-fill-color: transparent;
    background-color: #fff;
    background-image: linear-gradient(#fff 50%, #c3c3c3 0%);
    background-repeat: repeat;
    background-size: 100% 200%;
    transition: background-position .5s ease, opacity .5s ease;
    opacity: 0;
    z-index: 2;
}
.battery,
.battery-text,
.slider {
    margin: 0 auto;
    position: absolute;
    line-height: 5.38em;
    text-align: center;
    font-size: 30px;
    color: white;
    font-family: Ebrima;
    top: calc(36% - 153px);
    left: calc(50% - 39.5px);
}
.pointer { cursor: pointer }
.battery {
    border: 5px solid #00fa57;
    height: 160px;
    border-radius: 1px;
    width: 200px;
    background-color: #00fa57;
    background-image: linear-gradient(#00fa57 50%, #444 0%);
    background-repeat: repeat;
    background-size: 100% 200%;
    background-position: 0 -100%;
    transition: background-position .5s ease;
}
.battery::after {
    background-color: #00fa57;
    content: '';
    display: block;
    height: 10px;
    position: absolute;
    right: 20px;
    top: -15px;
    width: 30px;
    border-top: 1px solid transparent;
    border-bottom: 1px solid transparent;
    border-top-left-radius: 1px;
    border-top-right-radius: 1px;
}
.bubbles {
    display: inline-block;
    position: relative;
}
.battery-bubbles {
    width: 69px;
    left: calc(50% - 35px);
    height: 149px;
}
.bottom-bubbles {
    width: 49px;
    left: calc(50% - 30px);
    height: 150px;
}
.bubbles span {
    position: relative;
    margin: 3em 0 0; /* Height bubbles rise to */
    color: #fff;
    z-index: 2;
}
.individual-bubble {
    position: absolute;
    border-radius: 100%;
    bottom: 0;
    background-color: #00fa57;
    z-index: 1;
}
.vertical {
    writing-mode: bt-lr; /* IE */
    -webkit-appearance: slider-vertical; /* WebKit */
    width: 8px;
    height: 159.5px;
    margin: 0;
    margin-left: 95px;
}
.liquid {
    position: absolute;
    width: 190px;
    height: 5px;
    overflow: hidden;
    -webkit-backface-visibility: hidden;
    -webkit-transform: translate3d(0, 0, 0);
    -webkit-transform: translate(0, 50px);
            transform: translate(0, 50px);
    margin-top: -51px;
    transition: top .5s ease;
    display: none;
}
.wave {
    -webkit-animation-name: wave-action;
            animation-name: wave-action;
    -webkit-animation-iteration-count: infinite;
            animation-iteration-count: infinite;
    -webkit-animation-timing-function: linear;
            animation-timing-function: linear;
    -webkit-animation-duration: .8s;
            animation-duration: .8s;
    width: 70px;
    height: 1px;
    fill: #00fa57;
}
@-webkit-keyframes wave-action {
    0%   { -webkit-transform: translate(-150px, 0) }
    100% { -webkit-transform: translate(0, 0) }
}
@keyframes wave-action {
    0%   { transform: translate(-150px, 0) }
    100% { transform: translate(0, 0) }
}

/**/

@media all and (max-height: 332px){
   .onscreen { top: 11px }
}


_:-ms-lang(x), _:-webkit-full-screen, .individual-bubble { top: inherit !important }
  </style>
</head>

<body>
  <div id="main">
    <div class="nav" style="width: 100%; margin-left: -20px;">
      <span style="cursor:pointer; margin: 15px" onclick="openNav()">&#9776;</span>
      <div class="name"><a href="{{ url_for('dash')}}">Inverter Analytics</a></div>
      <ul>
        <a href="{{url_for('dash')}}"><img src="/static/logo.jpeg/" class="logo" alt="LOGO" /></a>
      </ul>
    </div>

    <div id="mySidenav" class="sidenav" style="z-index: 10;">
      <a href="javascript:void(0)" class="closebtn" onclick="closeNav()">&times;</a>
      <a href="{{ url_for('dash')}}">Home</a>
      <a href="{{ url_for('data_table')}}">Table</a>
      <a href="#" id="logout-btn">Log Out</a>
    </div>

    <!--  -->
    <div class="battery onscreen">
      <div class="bubbles battery-bubbles">
        <span>&nbsp;</span>
      </div>
      <div class="liquid liquid-bg-color">
        <svg version="1.1" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" x="0px" y="0px" width="300px" height="5px" viewBox="0 0 300 5" enable-background="new 0 0 300 5" xml:space="preserve">
          <path fill="#00fa57" class="wave" d="M300,300V2.5c0,0-0.6-0.1-1.1-0.1c0,0-25.5-2.3-40.5-2.4c-15,0-40.6,2.4-40.6,2.4
          c-12.3,1.1-30.3,1.8-31.9,1.9c-2-0.1-19.7-0.8-32-1.9c0,0-25.8-2.3-40.8-2.4c-15,0-40.8,2.4-40.8,2.4c-12.3,1.1-30.4,1.8-32,1.9
          c-2-0.1-20-0.8-32.2-1.9c0,0-3.1-0.3-8.1-0.7V300H300z" />
        </svg>
      </div><!-- .liquid -->
    </div>
    <div class="battery-text onscreen">
      <span class="percentage"></span><small class="units"></small>
    </div>
    <div class="slider onscreen">
    </div>
    <div class="page-spacer"></div>
    <div class="bubbles bottom-bubbles">
      <span>&nbsp;</span>
    </div>
  
    <script>
      function changeStylesheetRule(s, selector, property, value){
      // Make these strings lowercase
      selector = selector.toLowerCase();
      value    = value.toLowerCase();
  
      // Delete it if it exists
      for(var i = 0; i < s.cssRules.length; i++){
          var rule = s.cssRules[i];
          if(rule.selectorText === selector){
              s.deleteRule(i);
              break;
          }
      }
  
      // Convert camelCase to hyphenated-case
      property = property.replace(/([a-z])([A-Z])/g, '$1-$2').toLowerCase();
      s.insertRule(selector + " { " + property + ": " + value + "; }", 0);
  }
  
  // Function to select random array element
  // Used within the setInterval()
  function randomValue(arr){
      return arr[Math.floor(Math.random() * arr.length)];
  }
  
  jQuery.easing['jswing'] = jQuery.easing['swing'];
  jQuery.extend(jQuery.easing, {
      def: 'easeOutQuad',
      swing: function (x, t, b, c, d){
          return jQuery.easing[jQuery.easing.def](x, t, b, c, d);
      },
      easeOutQuad: function (x, t, b, c, d){
          return -c * (t /= d) * (t - 2) + b;
      },
  });
  
  $(document).ready(function(){
      var perc = '{{battery_chargefull}}';
      var s = document.styleSheets[0];
      // Define a size array, this will be used to vary bubble sizes
      var sArray = [];
  
      setTimeout(function(){
          updateBattery(perc, s);
          $('.percentage').text(perc);
          $('.units').text('%');
          $('.battery-text').css('opacity', 1);
          $('.slider input').animate({ value: perc }, 500, 'easeOutQuad');
  
          setTimeout(function(){
              $('.liquid').show();
          }, 500);
      }, 500);
  
      function updateBattery(perc, s){
          if(perc === 100){
              sArray = [];
          } else if(sArray.length === 0){
              sArray = [4, 6, 8, 10];
          }
  
      document.querySelector('.battery').style.backgroundPosition = `0 -${100 - perc}%`;
  document.querySelector('.battery-text').style.backgroundPosition = `0 -${100 - perc}%`;
  document.querySelector('.liquid').style.top = `${100 - perc}%`;
  
          if(perc === 100){
              changeStylesheetRule(s, '.liquid-bg-color', 'backgroundColor', '#00fa57');
          } else {
              changeStylesheetRule(s, '.liquid-bg-color', 'backgroundColor', '#444');
          }
      }
  
      // setInterval function used to create new bubble every 350 milliseconds
      setInterval(function(){
          if(sArray.length > 0){
              // Get a random size, defined as variable so it can be used for both width and height
              var size = randomValue(sArray);
  
              var largestSize = Math.max.apply(Math, sArray);
              var offset = largestSize / 2; // half to get the largest bubble radius
              offset += 5; // 5px for border-right
  
              // New bubble appended to div with it's size and left position being set inline
              $('.bubbles').each(function(){
                  var bArray = new Array(parseInt($(this).width()) - offset)
                                   .join()
                                   .split(',')
                                   .map(function(item, index){ return ++index; });
  
                  $(this).append('<div class="individual-bubble" style="left: ' + randomValue(bArray) + 'px; width: ' + size + 'px; height: ' + size + 'px"></div>');
              });
  
              // Animate each bubble to the top (bottom 100%) and reduce opacity as it moves
              // Callback function used to remove finished animations from the page
              $('.individual-bubble').animate({
                  'top': 0,
                  'bottom': '100%',
                  'opacity' : '-=0.7',
              }, 3000, function(){
                  $(this).remove();
              });
          }
      }, 350);
  
      $('.slider input').on('input', function(){
          $(this).stop(); // Terminate any running animation
          var original = this.value;
          // Set slider back to its starting value so we can animate the change
          this.value = perc;
          perc = parseInt(original);
          $(this).animate({ value: perc }, 500, 'easeOutQuad');
          $('.percentage').text(perc);
      }).on('mouseup', function(){
          // We need to manually call this to make sure things bubble up to the change event
          $(this).trigger('change');
      }).on('change', function(){
          updateBattery(perc, s);
      });
  });
    </script>

<br><br>
       <!-- DC DATA -->
    <h3 style="display: flex; justify-content: center;"><u><b>DC Data</b> || LAST PACKET : {{Dccurrent[1]}}</u></h3>
    <div class="con_small">
      <div class="half-width " style="text-align: center;">

        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center mt-2">{{Dccurrent[0]}}
          <span class=" ms-2 mt-4" style="font-size:18px">A</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>DC Current </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Dccurrent[4]}}
          <span class="mt-4 ms-2" style="font-size:15px">V</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>DC Voltage</b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Dccurrent[3]}}
          <span class="mt-4 ms-2" style="font-size:15px">°C</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Temperature</b></div>
      </div>
    </div>
    <div class="con_small">
      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Dccurrent[2]}}
          <span class="mt-4 ms-2" style="font-size:15px">W</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Input Power</b></div>
      </div>
      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Dccurrent[5]}}
          <span class="mt-4 ms-2" style="font-size:15px">W</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Cal. Power</b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{ Dccurrent[7] }}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Error</b></div>
      </div>
    </div>

    <div class="con_small">
      <div class="half-width " style="text-align: center;">
        {{dc_kwh[1]}} - {{dc_kwh[2]}}
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;"
          class="text-center mt-2">{{dc_kwh[0] if dc_kwh[0] is not none else 'N/A'}}
          <span class=" ms-2 mt-4" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>KWH (per Interval Hour) </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{dc_total_kwh_value}}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>KWH (24 Hours) </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{dc_total_unit[0]}}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Total units Generated </b></div>
      </div>
    </div>
    <hr>

    <!-- AC DATA -->
    <h3 style="display: flex; justify-content: center;"><u><b>AC Data</b> || LAST PACKET : {{Accurrent[1]}}</u></h3>
    <div class="con_small">
      <div class="half-width " style="text-align: center;">

        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center mt-2">{{Accurrent[0]}}
          <span class=" ms-2 mt-4" style="font-size:18px">A</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>AC Current </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Accurrent[4]}}
          <span class="mt-4 ms-2" style="font-size:15px">V</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>AC Voltage</b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Accurrent[3]}}
          <span class="mt-4 ms-2" style="font-size:15px">°C</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Temperature</b></div>
      </div>
    </div>
    <div class="con_small">
      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Accurrent[2]}}
          <span class="mt-4 ms-2" style="font-size:15px">W</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Output Power</b></div>
      </div>
      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{Accurrent[5]}}
          <span class="mt-4 ms-2" style="font-size:15px">W</span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Cal. Power</b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{ Accurrent[7] }}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Error</b></div>
      </div>
    </div>

    <div class="con_small">
      <div class="half-width " style="text-align: center;">
        {{ac_total_kwh[1]}} - {{ac_total_kwh[2]}}
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;"
          class="text-center mt-2">{{ac_total_kwh[0] if ac_total_kwh[0] is not none else 'N/A'}}
          <span class=" ms-2 mt-4" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>KWH (per Interval Hour) </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{total_kwh_value}}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>KWH (24 Hours) </b></div>
      </div>

      <div class="half-width">
        <br>
        <span style=" font-size: 40px;display: flex; justify-content: center;" class="text-center">{{total_unit[0]}}
          <span class=" ms-1" style="font-size:18px"></span> </span> <br>
        <div class="text-center" style="margin-bottom: 15px;"><b>Total units Consumed </b></div>
      </div>
    </div>

    <!-- Graphs -->
    <div class="chart1">
      <h5>AC Current, Ac Voltage & Power vs. Time </h5>
      <canvas id="live2" width="1400" height="430"></canvas>
    </div>

    <div class="chart1">
      <h5>DC Current, Dc Voltage & Power vs. Time</h5>
      <canvas id="live1" width="1400" height="450"></canvas>
    </div>

    <!-- Alert -->
    <div class="line2">
      <h5>Smart Alerts</h5>
    </div>
    <br>
  </div>

  <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/chartjs-adapter-date-fns"></script>

  <!-- script for battery -->
  <script>
    
    let batteryLevel ='{{battery_chargefull}}';

    document.getElementById('batteryOverlay').style.setProperty('--battery-level', batteryLevel);
    document.getElementById('batteryPercentage').innerText = batteryLevel + '%';

    const batteryOverlay = document.getElementById('batteryOverlay');
    if (batteryLevel > 50) {
      batteryOverlay.style.background = `conic-gradient(green 0deg, green calc(3.6deg * ${batteryLevel}), #222 calc(3.6deg * ${batteryLevel}), #222 360deg)`;
    } else if (batteryLevel > 20) {
      batteryOverlay.style.background = `conic-gradient(yellow 0deg, yellow calc(3.6deg * ${batteryLevel}), #222 calc(3.6deg * ${batteryLevel}), #222 360deg)`;
    } else {
      batteryOverlay.style.background = `conic-gradient(red 0deg, red calc(3.6deg * ${batteryLevel}), #222 calc(3.6deg * ${batteryLevel}), #222 360deg)`;
    }
  </script>

  <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"></script>
  <script>
    function openNav() {
      document.getElementById("mySidenav").style.width = "250px";
      document.getElementById("main").style.marginLeft = "250px";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      document.getElementById("main").style.marginLeft = "0";
    }
  </script>

  <!--live dc -->
  <script>
    const id = '{{Dccurrent[6]}}'; // Assuming this is correctly set in your template
let chart4 = null;

function livegraphDc() {
  fetch(`/livegraphdc/${id}`)
    .then(response => {
      if (!response.ok) {
        throw new Error(`HTTP error! Status: ${response.status}`);
      }
      return response.json();
    })
    .then(data => {
      if (!Array.isArray(data)) {
        throw new Error("Data is not an array.");
      }

      const now = new Date();
      const last24Hours = new Date(now.getTime() - 24 * 60 * 60 * 1000);

      const filteredData = data.filter(item => new Date(item.timestamp) >= last24Hours);

      const labels = filteredData.map(item => new Date(item.timestamp));
      const voltageValues = filteredData.map(item => item.Dc_Voltage);
      const currentValues = filteredData.map(item => item.Dc_Current);
      const powerValues = filteredData.map(item => item.Dc_Voltage * item.Dc_Current);

      if (chart4) {
        chart4.destroy();
      }

      const ctx = document.getElementById('live1').getContext('2d');
      chart4 = new Chart(ctx, {
        type: 'line',
        data: {
          labels: labels,
          datasets: [
            {
              label: 'DC Voltage (V)',
              data: voltageValues,
              borderColor: '#56ccf0',
              backgroundColor: 'rgba(0, 0, 0, 0)',
              borderWidth: 2,
              fill: false,
              tension: 0.3
            },
            {
              label: 'DC Current (A)',
              data: currentValues,
              borderColor: '#f05c56',
              backgroundColor: 'rgba(0, 0, 0, 0)',
              borderWidth: 2,
              fill: false,
              tension: 0.3
            },
            {
              label: 'Power (W)',
              data: powerValues,
              borderColor: '#f0d756',
              backgroundColor: 'rgba(0, 0, 0, 0)',
              borderWidth: 2,
              fill: false,
              tension: 0.3
            }
          ]
        },
        options: {
          scales: {
            x: {
              type: 'time',
              time: {
                unit: 'minute',
                tooltipFormat: 'MMM d, h:mm a'
              },
              grid: {
                display: false
              }
            },
            y: {
              beginAtZero: true,
              grid: {
                display: false
              },
              title: {
                display: true,
                text: 'Values (Voltage in V, Current in A, Power in W)'
              }
            }
          }
        }
      });
    })
    .catch(error => {
      console.error('Error fetching graph data:', error);
    });
}

livegraphDc();

  </script>

  <!--live Ac -->
  <script>
    const id1 = '{{Accurrent[6]}}'
    let chart5 = null;
    function livegraphAc() {
      fetch(`/livegraphac/${id1}`)
        .then(response => {
          if (!response.ok) {
            throw new Error(`HTTP error! Status: ${response.status}`);
          }
          return response.json();
        })
        .then(data => {
          if (!Array.isArray(data)) {
            throw new Error("Data is not an array.");
          }

          const labels = data.map(item => new Date(item.timestamp));
          const voltageValues = data.map(item => item.Voltage);
          const currentValues = data.map(item => item.Current);
          const powerValues = data.map(item => item.Voltage * item.Current);

          if (chart5) {
            chart5.destroy();
          }

          const ctx = document.getElementById('live2').getContext('2d');
          chart5 = new Chart(ctx, {
            type: 'line',
            data: {
              labels: labels,
              datasets: [
                {
                  label: 'AC Voltage (V)',
                  data: voltageValues,
                  borderColor: '#56ccf0',
                  backgroundColor: 'rgba(0, 0, 0, 0)',
                  borderWidth: 2,
                  fill: false,
                  tension: 0.3
                },
                {
                  label: 'AC Current (A)',
                  data: currentValues,
                  borderColor: '#f05c56',
                  backgroundColor: 'rgba(0, 0, 0, 0)',
                  borderWidth: 2,
                  fill: false,
                  tension: 0.3
                },
                {
                  label: 'Power (W)',
                  data: powerValues,
                  borderColor: '#00b894',
                  backgroundColor: 'rgba(0, 0, 0, 0)',
                  borderWidth: 2,
                  fill: false,
                  tension: 0.3
                }
              ]
            },
            options: {
              scales: {
                x: {
                  type: 'time',
                  time: {
                    unit: 'hour',
                    tooltipFormat: 'MMM d, h:mm a'
                  },
                  grid: {
                    display: false
                  }
                },
                y: {
                  beginAtZero: true,
                  grid: {
                    display: false
                  },
                  title: {
                    display: true,
                    text: 'Values (Voltage in V, Current in A, Power in W)'
                  }
                }
              }
            }
          });
        })
        .catch(error => {
          console.error('Error fetching graph data:', error);
        });
    }
    livegraphAc();
</script>

  <!-- script for logout -->
  <script>
    document.getElementById('logout-btn').addEventListener('click', function (event) {
      event.preventDefault();
      window.location.href = "{{ url_for('logout') }}";
    });
  </script>

  <!-- script for session out automatically -->
  <script>
    var timeout;
    var logoutTime = 30 * 60 * 1000; // 30 minutes in milliseconds

    function resetTimer() {
      clearTimeout(timeout);
      timeout = setTimeout(logout, logoutTime);
    }

    function logout() {
      window.location.href = "{{ url_for('logout') }}";
    }

    document.onload = resetTimer;
    document.onmousemove = resetTimer;
    document.onkeypress = resetTimer;

    // Initial call to start the timer
    resetTimer();
  </script>
</body>
</html>
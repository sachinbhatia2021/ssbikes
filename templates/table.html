<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8" />
  <meta http-equiv="content-type" content="text/html; charset=utf-8" />
  <meta
    http-equiv="Cache-Control"
    content="no-cache, no-store, must-revalidate"
  />
  <meta http-equiv="Pragma" content="no-cache" />
  <meta http-equiv="Expires" content="0" />
  <script src="https://stackpath.bootstrapcdn.com/bootstrap/5.3.0/js/bootstrap.bundle.min.js"></script>
  <meta http-equiv="X-UA-Compatible" content="IE edge" />
  <meta
    name="viewport"
    content="width=device-width, initial-scale=1, maximum-scale=1"
  />
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.7.2/css/all.min.css" integrity="sha512-Evv84Mr4kqVGRNSgIGL/F/aIDqQb7xQ2vcrdIwxfjThSH8CSR7PBEakCr51Ck+w+/U6swU2Im1vVX0SVk9ABhg==" crossorigin="anonymous" referrerpolicy="no-referrer" />
  <link
    rel="stylesheet"
    href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css"
  />
  <link rel="icon" type="image/x-icon" href="/static/logo.jpeg" />
  <link
    href="https://cdn.datatables.net/1.12.1/css/dataTables.bootstrap5.min.css"
    rel="stylesheet"
  />
  <link
    href="https://fonts.googleapis.com/css2?family=Lato:ital,wght@0,100;0,300;0,400;0,700;0,900;1,100;1,300;1,400;1,700;1,900&family=Nanum+Brush+Script&family=Open+Sans:wght@600&family=Poppins:wght@200;400;500;600;700;900&family=Roboto:ital,wght@0,300;0,400;0,500;0,700;0,900;1,300;1,400;1,500&display=swap"
    rel="stylesheet"
  />
  <link
    href="https://maxcdn.bootstrapcdn.com/bootstrap/4.5.2/css/bootstrap.min.css"
    rel="stylesheet"
  />
  <link
    rel="stylesheet"
    href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"
  />
  <script
    src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/js/bootstrap.bundle.min.js"
    integrity="sha384-YvpcrYf0tY3lHB60NNkmXc5s9fDVZLESaAA55NDzOxhy9GkcIdslK1eN7N6jIeHz"
    crossorigin="anonymous"
  ></script>
  <script src="https://code.jquery.com/jquery-3.6.0.min.js"></script>
  <script src="https://cdn.datatables.net/1.11.5/js/jquery.dataTables.js"></script>
  <link rel="stylesheet" href="../static/nav_foot.css">

  <title>Inverter Analytics</title>

</head>
<body>
<!-- navbar for mobileview -->
<div class="mobileshow">
  <div class="nav">
    <a href="{{ url_for('dash') }}"><img src="/static/logo.jpeg" class="logo" alt="LOGO" /></a>
    <ul>
      <li><a href="{{ url_for('data_table') }}" class="ex2">Table</a></li>
      <a href="{{url_for('alldevices')}}">Devices</a>

      <a href="#" id="logout-btn">Log Out</a>
    </ul>
  </div>
</div>

<!-- side navbar -->
<div class="navbg text-center ">
  <div class="text d-flex">
    <div class="hideicon">
      <a href="{{ url_for('dash') }}" class="ex2 me-2">
        <img class="ms-1" src="/static/logo.jpeg" height="39px" style="margin-left: -5px;" alt="">

      </a>
      
      <a href="{{url_for('alldevices')}}"><h3><i class="bi bi-projector"></i></h3></a>

      <a href="#" id="logout-btn">
        <h3><i class="fa-solid fa-arrow-right-from-bracket"></i></h3>
      </a>
    </div>
    <!-- next txtdiv link -->

    <div class="mt-2" style="font-size: 25px;">
<h4 class="text-light mt-3">Analytics</h4>
<a href="{{url_for('alldevices')}}" class="ex2 mt-4">Devices</a>


      <a class="mt-2" href="#" id="logout-btn" class="ex2 mt-5">Log Out</a>
    </div>
  </div>
</div>
<br><br><br>
<!--  -->
<div class="content ">
   <div class="row1 Inverter1">
      <section class="col-lg-12 connectedSortable scroll">
        <div class="">
          <div class="card-header">
            <h4 class="card-title"><i class='bx bxs-data'></i> Panel Data</h4>
          </div>
          <div class="row">
            <div class="card-body x">
              <div >

              <table id="example21" class="table table-bordered table-striped" style="margin-top: 80px;">
                <thead>
                  <tr>
                    <th>Device ID</th>
                    <th>Timestamp</th>
                    <th>Current</th>
                    <th>Voltage</th>
                    <th>Power</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in alldataprint %}
                  <tr>
                    <td>{{ item['Device_id'] }}</td>
                    <td>{{ item['timestamp'] }}</td>
                    <td>{{ item['panel_current'] }}</td>
                    <td>{{ item['panel_voltage'] }}</td>
                    <td>{{ item['Panel_Power'] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
          </div>
      </section>
    </div>
    <br><br>
    <div class="row1 Inverter1">
      <section class="col-lg-12 connectedSortable scroll">
        <div class="">
          <div class="card-header">
            <h4 class="card-title"><i class='bx bxs-data'></i> DC Data</h4>
          </div>
          <div class="row">
            <div class="card-body x">
              <div >

              <table id="example2" class="table table-bordered table-striped" style="margin-top: 80px;">
                <thead>
                  <tr>
                    <th>Device ID</th>
                    <th>Timestamp</th>
                    <th>DC Current</th>
                    <th>DC Voltage</th>
                    <th>DC Power</th>
                    <th>DC KWh</th>
                    <!-- <th>DC Units</th> -->
                    <th>Temperature</th>

                  </tr>
                </thead>
                <tbody>
                  {% for item in alldataprint %}
                  <tr>
                    <td>{{ item['Device_id'] }}</td>
                    <td>{{ item['timestamp'] }}</td>
                    <td>{{ item['Dc_Current'] }}</td>
                    <td>{{ item['Dc_Voltage'] }}</td>
                    <td>{{ item['Dc_Power'] }}</td>
                    <td>{{ item['Dc_KWH'] }}</td>
                    <!-- <td>{{ item['Dc_Units'] }}</td> -->
                    <td>{{ item['Temperature'] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>

              </table>
</div>
            </div>
            </div>
          </div>
      </section>
    </div>
    <br><br>
    <div class=" Inverter1">
      <section class="col-lg-12 connectedSortable scroll">
        <div class="">
          <div class="card-header">
            <h4 class="card-title"><i class='bx bxs-data'></i> DC KWH Data</h4>
          </div>
          <div class="row">
            <div class="card-body x">
          <div >

              <table id="example4" class="table table-bordered table-striped" style="margin-top: 80px;">
                <thead>
                  <tr>
                    <th>Device ID</th>
                    <th>Start Hour</th>
                    <th>End Hour</th>
                    <th>KWH per hour</th>
                    <th>KWH 24-Hour</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in dc_kwh_dataprint %}
                  <tr>
                    <td>{{ item['Device_id'] }}</td>
                    <td>{{ item['start_hour'] }}</td>
                    <td>{{ item['end_hour'] }}</td>
                    <td>{{ item['avg_kWh'] }}</td>
                    <td>{{ item['24_kwh'] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
</div>
            </div>
          </div>
      </section>
    </div>

    <br><br>
    <div class="row1 Inverter1">
      <section class="col-lg-12 connectedSortable scroll">
        <div class="">
          <div class="card-header">
            <h4 class="card-title"><i class='bx bxs-data'></i> AC Data</h4>
          </div>
          <div class="row">
            <div class="card-body x">
              <div >

              <table id="example3" class="table table-bordered table-striped" style="margin-top: 80px;">
                <thead>
                  <tr>
                    <th>Device ID</th>
                    <th>Timestamp</th>
                    <th>Temperature</th>
                    <th>Ac Voltage</th>
                    <th>Ac Current</th>
                    <th>Ac Power</th>
                    <th>Ac KWH</th>
                    <th>Frequency</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in Acalldataprint %}
                  <tr>
                    <td>{{ item['Device_id'] }}</td>
                    <td>{{ item['timestamp'] }}</td>
                    <td>{{ item['Temperature'] }}</td>
                    <td>{{ item['Voltage'] }}</td>
                    <td>{{ item['Current'] }}</td>
                    <td>{{ item['Power'] }}</td>
                    <td>{{ item['kWh_Consumed'] }}</td>
                    <td>{{ item['Frequency'] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
            </div>
            </div>
          </div>
      </section>
    </div>
<br> <br>
    <div class="row1 Inverter1">
      <section class="col-lg-12 connectedSortable scroll">
        <div class="">
          <div class="card-header">
            <h4 class="card-title"><i class='bx bxs-data'></i> AC KWH Data</h4>
          </div>
          <div class="row">
            <div class="card-body x">
              <div>

              <table id="example5" class="table table-bordered table-striped" style="margin-top: 80px;">
                <thead>
                  <tr>
                    <th>Device ID</th>
                    <th>Start Hour</th>
                    <th>End Hour</th>
                    <th>KWH per hour</th>
                    <th>KWH 24-Hour</th>
                  </tr>
                </thead>
                <tbody>
                  {% for item in ac_kwh_dataprint %}
                  <tr>
                    <td>{{ item['Device_id'] }}</td>
                    <td>{{ item['start_hour'] }}</td>
                    <td>{{ item['end_hour'] }}</td>
                    <td>{{ item['avg_kWh'] }}</td>
                    <td>{{ item['24_kwh'] }}</td>
                  </tr>
                  {% endfor %}
                </tbody>
              </table>
</div>
            </div>
          </div>
      </section>
    </div>

    <br>
    
     <!-- Footer -->
     <div class="footer  d-flex justify-content-between ">
      <p  >   Copyright © 2024 <a href="" target="_blank" class="linnk">Skilancer Solar</a> .
        All rights reserved.</p>
      <p class="version">Version 1.0.1</p>
    </div>
  </div>

  <script>
    function openNav() {
      document.getElementById("mySidenav").style.width = "250px";
      document.getElementById("main").style.marginLeft = "250px";
    }

    function closeNav() {
      document.getElementById("mySidenav").style.width = "0";
      document.getElementById("main").style.marginLeft = "0";
    }
  </script>
  <script>
    $(document).ready(function () {
      var table = $('#example21').DataTable({
        "pageLength": 10,
        "order": [
          [1, "desc"]
        ],
        "drawCallback": function (settings) {
          $('#example21 thead').css({
            'background-color': '#045B62',
            'color': 'white',
            'border': '1px solid #F7F6F7',
          });
          $('#example21_paginate').css({
            'text-align': 'center',
            'cursor': 'pointer'
          });
          $('#example21_previous').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '2px 0 0 2px',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('#example21_next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0 2px 2px 0',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('.paginate_button').not('.previous, .next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0',
            'color': '#999699',
            'display': 'inline-block',
            'margin': '0 -0px 0 -0px'
          });

          $('.paginate_button.current').css({
            'background-color': '#007BFF',
            'color': 'white',
            'border': '1px solid #007BFF'
          });
        }
      });

      $('#example21_filter').css({ 'margin-left': '75%' });

      $('#searchInput').on('keyup', function () {
        table.search($(this).val()).draw();
      });
    });
  </script>

  <script>
    $(document).ready(function () {
      var table = $('#example2').DataTable({
        "pageLength": 10,
        "order": [
          [1, "desc"]
        ],
        "drawCallback": function (settings) {
          $('#example2 thead').css({
            'background-color': '#045B62',
            'color': 'white',
            'border': '1px solid #F7F6F7',
          });
          $('#example2_paginate').css({
            'text-align': 'center',
            'cursor': 'pointer'
          });
          $('#example2_previous').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '2px 0 0 2px',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('#example2_next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0 2px 2px 0',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('.paginate_button').not('.previous, .next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0',
            'color': '#999699',
            'display': 'inline-block',
            'margin': '0 -0px 0 -0px'
          });

          $('.paginate_button.current').css({
            'background-color': '#007BFF',
            'color': 'white',
            'border': '1px solid #007BFF'
          });
        }
      });

      $('#example2_filter').css({ 'margin-left': '75%' });

      $('#searchInput').on('keyup', function () {
        table.search($(this).val()).draw();
      });
    });
  </script>

  <script>
    $(document).ready(function () {
      var table = $('#example3').DataTable({
        "pageLength": 10,
        "order": [
          [1, "desc"]
        ],
        "drawCallback": function (settings) {
          $('#example3 thead').css({
            'background-color': '#045B62',
            'color': 'white',
            'border': '1px solid #F7F6F7',
          });
          $('#example3_paginate').css({
            'text-align': 'center',
            'cursor': 'pointer'
          });
          $('#example3_previous').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '2px 0 0 2px',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('#example3_next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0 2px 2px 0',
            'display': 'inline-block',
            'color': '#007BFF',
            'margin': '0'
          });
          $('.paginate_button').not('.previous, .next').css({
            'padding': '4px 8px',
            'border': '1px solid #e3e3e3',
            'border-radius': '0',
            'color': '#999699',
            'display': 'inline-block',
            'margin': '0 -0px 0 -0px'
          });

          $('.paginate_button.current').css({
            'background-color': '#007BFF',
            'color': 'white',
            'border': '1px solid #007BFF'
          });
        }
      });

      $('#example3_filter').css({ 'margin-left': '75%' });

      $('#searchInput').on('keyup', function () {
        table.search($(this).val()).draw();
      });
    });
  </script>

<script>
  $(document).ready(function () {
    var table = $('#example4').DataTable({
      "pageLength": 10,
      "order": [
        [1, "desc"]
      ],
      "drawCallback": function (settings) {
        $('#example4 thead').css({
          'background-color': '#045B62',
          'color': 'white',
          'border': '1px solid #F7F6F7',
        });
        $('#example4_paginate').css({
          'text-align': 'center',
          'cursor': 'pointer'
        });
        $('#example4_previous').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '2px 0 0 2px',
          'display': 'inline-block',
          'color': '#007BFF',
          'margin': '0'
        });
        $('#example4_next').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '0 2px 2px 0',
          'display': 'inline-block',
          'color': '#007BFF',
          'margin': '0'
        });
        $('.paginate_button').not('.previous, .next').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '0',
          'color': '#999699',
          'display': 'inline-block',
          'margin': '0 -0px 0 -0px'
        });

        $('.paginate_button.current').css({
          'background-color': '#007BFF',
          'color': 'white',
          'border': '1px solid #007BFF'
        });
      }
    });

    $('#example4_filter').css({ 'margin-left': '75%' });

    $('#searchInput').on('keyup', function () {
      table.search($(this).val()).draw();
    });
  });
</script>

<script>
  $(document).ready(function () {
    var table = $('#example5').DataTable({
      "pageLength": 10,
      "order": [
        [1, "desc"]
      ],
      "drawCallback": function (settings) {
        $('#example5 thead').css({
          'background-color': '#045B62',
          'color': 'white',
          'border': '1px solid #F7F6F7',
        });
        $('#example5_paginate').css({
          'text-align': 'center',
          'cursor': 'pointer'
        });
        $('#example5_previous').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '2px 0 0 2px',
          'display': 'inline-block',
          'color': '#007BFF',
          'margin': '0'
        });
        $('#example5_next').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '0 2px 2px 0',
          'display': 'inline-block',
          'color': '#007BFF',
          'margin': '0'
        });
        $('.paginate_button').not('.previous, .next').css({
          'padding': '4px 8px',
          'border': '1px solid #e3e3e3',
          'border-radius': '0',
          'color': '#999699',
          'display': 'inline-block',
          'margin': '0 -0px 0 -0px'
        });

        $('.paginate_button.current').css({
          'background-color': '#007BFF',
          'color': 'white',
          'border': '1px solid #007BFF'
        });
      }
    });

    $('#example5_filter').css({ 'margin-left': '75%' });

    $('#searchInput').on('keyup', function () {
      table.search($(this).val()).draw();
    });
  });
</script>

<!-- logout -->
<script>
    document.getElementById('logout-btn').addEventListener('click', function (event) {
      function logout() {
      fetch('/logout', {
        method: 'POST',
        headers: {
          'Content-Type': 'application/json'
        }
      })
        .then(response => {
          if (response.ok) {
            window.location.href = '/';
          } else {
            window.location.href = '/';
          }
        })
        .catch(error => {
          console.error('Logout failed:', error);
          window.location.href = '/';
        });
    }

    function preventBack() {

      window.history.replaceState(null, null, window.location.href);
      window.onpopstate = function () {
        window.history.replaceState(null, null, window.location.href);
        window.location.href = '/';
      };
    }

    logout();
    preventBack();
  });

</script>

<!-- for automatically logout -->
<script>
  var timeout;
  var logoutTime = 30 * 60 * 1000; // 30 minutes

  function resetTimer() {
    clearTimeout(timeout);
    timeout = setTimeout(logout, logoutTime);
  }

  function logout() {
    fetch('/logout', {
      method: 'POST',
      headers: {
        'Content-Type': 'application/json'
      }
    })
      .then(response => {
        if (response.ok) {
          window.location.href = '/';
        } else {
          window.location.href = '/';
        }
      })
      .catch(error => {
        console.error('Logout failed:', error);
        window.location.href = '/';
      });
  }

  document.onload = resetTimer;
  document.onmousemove = resetTimer;
  document.onkeypress = resetTimer;

  resetTimer();

  function preventBack() {
    window.history.replaceState(null, null, window.location.href);
    window.onpopstate = function () {
      window.history.replaceState(null, null, window.location.href);
      window.location.href = '/';
    };
  }

  if (window.location.pathname === "/") {
    preventBack();
  }
</script>

</body>

</html>